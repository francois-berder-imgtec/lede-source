From 75f77cb138894c0e895022d6c91061664406d049 Mon Sep 17 00:00:00 2001
From: Xue Liu <liuxuenetmail@gmail.com>
Date: Mon, 6 Feb 2017 17:43:19 +0000
Subject: [PATCH] net: micrel: Disable PME

Disable PME for Micrel phy driver allowing the Ethernet ports LED
driver to work on marduk platform.

Signed-off-by: Xue Liu <liuxuenetmail@gmail.com>
---
 drivers/net/phy/micrel.c | 6 ++++++
 1 file changed, 6 insertions(+)

--- a/drivers/net/phy/micrel.c
+++ b/drivers/net/phy/micrel.c
@@ -261,6 +261,7 @@ static int kszphy_config_init(struct phy
 	struct kszphy_priv *priv = phydev->priv;
 	const struct kszphy_type *type;
 	int ret;
+	int temp = 0;
 
 	if (!priv)
 		return 0;
@@ -284,6 +285,11 @@ static int kszphy_config_init(struct phy
 	if (priv->led_mode >= 0)
 		kszphy_setup_led(phydev, type->led_mode_reg, priv->led_mode);
 
+	/* disable PME */
+	temp = phy_read(phydev, 0x16);
+	temp &= ~(1 << 15);
+	phy_write(phydev, 0x16, temp);
+
 	return 0;
 }
 
